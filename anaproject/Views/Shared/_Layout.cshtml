<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>@ViewData["Title"] - SOFT</title>
    <link rel="stylesheet" href="~/lib/bootstrap/dist/css/bootstrap.min.css" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" href="~/css/site.css" asp-append-version="true" />
    <link rel="stylesheet" href="~/anaproject.styles.css" asp-append-version="true" />
    <link rel="icon" type="image/png" href="~/img/logoDARK.png" />
    <link rel="stylesheet" href="~/lib/aos.css" />
</head>
<body>
    <div id="global-loader">
        <div class="loader-spinner"></div>
    </div>
    <!-- HEADER & MENU -->
    <header class="audi-header">
        <div class="audi-logo">
            <a href="@Url.Action("Index" , "Page")"><img src="/img/softLOGOS.png" alt="SOFT logo" height="40" /></a>
        </div>
        <nav class="audi-main-nav">
    <ul>
        <li class="mega-dropdown">
            <a href="#" class="mega-toggle audi-btn-outline" id="modellerMenu" data-bs-toggle="tooltip" title="Tüm modelleri gör">Modeller</a>
            <div class="mega-menu" id="modellerDropdown">
                <div class="mega-col"><h4><a href="@Url.Action("Index", "AllModels")">Tüm Modeller</a></h4></div>
                <div class="mega-col"><h4><a href="@Url.Action("Index", "SUV")">SUV</a></h4></div>
                <div class="mega-col"><h4><a href="@Url.Action("Index", "Sedan")">Sedan</a></h4></div>
                <div class="mega-col"><h4><a href="@Url.Action("Index", "Coupe")">Coupe</a></h4></div>
                <div class="mega-col"><h4><a href="@Url.Action("Index", "GTX")">GTX</a></h4></div>
                <div class="mega-col"><h4><a href="@Url.Action("Index", "Van")">Van</a></h4></div>
                <div class="mega-col"><h4><a href="@Url.Action("Index", "Moto")">Moto</a></h4></div>
                <div class="mega-col"><h4><a href="@Url.Action("Index", "OffRoad")">Off-Road</a></h4></div>
                <div class="mega-col"><h4><a href="@Url.Action("Index", "Public")">Public Transport</a></h4></div>
                <div class="mega-col"><h4><a href="@Url.Action("Index", "Collection")">Koleksiyon</a></h4></div>
            </div>
        </li>
              
                <li><a href="@Url.Action("Index", "Elektromobilite")" class="audi-btn-outline" data-bs-toggle="tooltip" title="Elektrikli mobilite hakkında bilgi">Elektromobilite</a></li>
        <li><a href="@Url.Action("Index", "Sales")" class="audi-btn-outline" data-bs-toggle="tooltip" title="Araç satış ve finansman">Satış</a></li>
        <li><a href="@Url.Action("Stories", "Home")" class="audi-btn-outline" data-bs-toggle="tooltip" title="İlham veren hikayeler">İlerleme Hikayeleri</a></li>
        <li><a href="@Url.Action("Index", "Admin")" class="audi-btn-outline" data-bs-toggle="tooltip" title="Admin Panel">Admin</a></li>
    </ul>
</nav>
    </header>

    <div class="audi-bg-wrapper">
        <div class="container">
            <main role="main" class="pb-3" id="main-content">
                @RenderBody()
            </main>
        </div>
    </div>

    <div class="footer-wave-anim" style="width:100%;overflow:hidden;line-height:0;position:relative;z-index:1;">
      <svg viewBox="0 0 1440 120" width="100%" height="80" preserveAspectRatio="none" style="display:block;position:relative;z-index:1;">
        <path class="wave1" d="M0,80 C360,160 1080,0 1440,80 L1440,120 L0,120 Z" fill="#00e6d0" fill-opacity="0.13"></path>
        <path class="wave2" d="M0,100 C400,0 1040,200 1440,60 L1440,120 L0,120 Z" fill="#00e6d0" fill-opacity="0.22"></path>
      </svg>
    </div>
    <footer class="audi-footer">
        <div class="audi-footer-links">
            <a href="#" id="fiyatListesiBtn">Fiyat Listesi</a>
            <a href="/YetkiliSaticilar/Index">Yetkili Satıcılar</a>
            <a href="#" id="servisRandevuBtn">Servis Randevusu</a>
            <a href="@Url.Action("Index", "Shop")">SOFT Shop</a>
            <a href="@Url.Action("Index", "Collection")">Koleksiyon</a>
            <a href="@Url.Action("Index", "Emergency")">Acil Yol Yardım</a>
        </div>
        <div class="audi-footer-copy">&copy; 2025 SOFT Türkiye. Tüm hakları saklıdır.</div>
    </footer>

    <!-- Fiyat Listesi Modal -->
    <div class="modal fade" id="fiyatListesiModal" tabindex="-1" aria-labelledby="fiyatListesiModalLabel" aria-hidden="true">
      <div class="modal-dialog modal-lg modal-dialog-centered">
        <div class="modal-content soft-modal-bg">
          <div class="modal-header">
            <h5 class="modal-title soft-section-title" id="fiyatListesiModalLabel">Fiyat Listesi</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Kapat"></button>
          </div>
          <div class="modal-body">
            <div id="fiyatListesiLoading" class="text-center my-4" style="display:none;">
              <div class="spinner-border text-info" role="status"><span class="visually-hidden">Yükleniyor...</span></div>
            </div>
            <div id="fiyatListesiError" class="alert alert-danger d-none">Fiyatlar yüklenemedi. Lütfen daha sonra tekrar deneyin.</div>
            <div id="fiyatListesiTableWrap">
              <table class="table table-dark table-striped align-middle">
                <thead>
                  <tr>
                    <th>Model</th>
                    <th>Yıl</th>
                    <th>Tür</th>
                    <th>Fiyat</th>
                  </tr>
                </thead>
                <tbody id="fiyatListesiTableBody">
                  <!-- JS ile doldurulacak -->
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Servis Randevusu Modal -->
    <div class="modal fade" id="servisRandevuModal" tabindex="-1" aria-labelledby="servisRandevuModalLabel" aria-hidden="true">
      <div class="modal-dialog modal-lg modal-dialog-centered">
        <div class="modal-content soft-modal-bg">
          <div class="modal-header">
            <h5 class="modal-title soft-section-title" id="servisRandevuModalLabel">Servis Randevusu Al</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Kapat"></button>
          </div>
          <div class="modal-body">
            <form id="servisRandevuForm">
              <div class="row g-3">
                <div class="col-md-6"><input type="text" class="form-control" name="Name" placeholder="Adınız" required></div>
                <div class="col-md-6"><input type="text" class="form-control" name="Surname" placeholder="Soyadınız" required></div>
                <div class="col-md-6"><input type="tel" class="form-control" name="Phone" placeholder="Telefon" required></div>
                <div class="col-md-6"><input type="email" class="form-control" name="Email" placeholder="E-posta" required></div>
                <div class="col-md-6"><input type="text" class="form-control" name="CarModel" placeholder="Araç Modeli" required></div>
                <div class="col-md-6"><input type="text" class="form-control" name="Plate" placeholder="Plaka" required></div>
                <div class="col-md-6"><input type="datetime-local" class="form-control" name="AppointmentDate" required></div>
                <div class="col-md-6"><input type="text" class="form-control" name="Description" placeholder="Açıklama (isteğe bağlı)"></div>
              </div>
              <div class="mt-4 d-flex justify-content-end">
                <button type="submit" class="btn btn-info">Randevu Oluştur</button>
              </div>
            </form>
            <div id="servisRandevuSuccess" class="alert alert-success mt-3 d-none">Randevunuz başarıyla oluşturuldu. En kısa sürede sizinle iletişime geçilecektir.</div>
            <div id="servisRandevuError" class="alert alert-danger mt-3 d-none">Bir hata oluştu. Lütfen tekrar deneyin.</div>
          </div>
        </div>
      </div>
    </div>

    <style>
    .soft-modal-bg { background: #23232b; color: #e0f7f4; border-radius: 1.2rem; }
    .soft-section-title { color: #00e6d0; text-shadow: 0 1px 8px #00e6d077; }
    .table-dark th, .table-dark td { color: #e0f7f4; }
    </style>

    <script src="~/lib/jquery/dist/jquery.min.js"></script>
    <script src="~/lib/bootstrap/dist/js/bootstrap.bundle.min.js"></script>
    <script src="~/js/site.js" asp-append-version="true"></script>
    <script src="~/lib/aos.js"></script>
    <script>AOS.init({ once: true, duration: 800, easing: 'ease-out-cubic' });</script>
    
    <!-- Floating Collection Button -->
    <style>
    .floating-collection-btn {
        position: fixed;
        bottom: 30px;
        right: 30px;
        width: 60px;
        height: 60px;
        background: linear-gradient(135deg, #00e6d0, #00b3a0);
        border: none;
        border-radius: 50%;
        color: #23232b;
        cursor: pointer;
        box-shadow: 0 4px 20px rgba(0, 230, 208, 0.3);
        transition: all 0.3s ease;
        z-index: 1000;
        display: flex;
        align-items: center;
        justify-content: center;
        text-decoration: none;
        line-height: 1;
    }
    
    .floating-collection-btn svg {
        width: 24px;
        height: 24px;
        transition: transform 0.3s ease;
    }
    
    .floating-collection-btn:hover {
        transform: scale(1.1);
        box-shadow: 0 6px 25px rgba(0, 230, 208, 0.4);
        color: #23232b;
        text-decoration: none;
    }
    
    .floating-collection-btn:hover svg {
        transform: rotate(15deg);
    }
    
    .floating-collection-btn::before {
        content: 'Koleksiyon';
        position: absolute;
        right: 70px;
        background: #23232b;
        color: #00e6d0;
        padding: 8px 12px;
        border-radius: 6px;
        font-size: 0.8rem;
        white-space: nowrap;
        opacity: 0;
        transition: opacity 0.3s ease;
        pointer-events: none;
    }
    
    .floating-collection-btn:hover::before {
        opacity: 1;
    }
    
    @@media (max-width: 768px) {
        .floating-collection-btn {
            bottom: 20px;
            right: 20px;
            width: 50px;
            height: 50px;
        }
        
        .floating-collection-btn svg {
            width: 20px;
            height: 20px;
        }
    }
    </style>
    
    <a href="@Url.Action("Index", "Collection")" class="floating-collection-btn" title="Koleksiyon Modelleri">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
            <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
        </svg>
    </a>
    
    @await RenderSectionAsync("Scripts", required: false)
    <script>
    $(function() {
      // Tüm Fiyat Listesi butonlarını yakala
      $(document).on('click', 'a:contains("Fiyat Listesi")', function(e) {
        e.preventDefault();
        $('#fiyatListesiModal').modal('show');
        loadFiyatListesi();
      });

      function loadFiyatListesi() {
        $('#fiyatListesiLoading').show();
        $('#fiyatListesiError').addClass('d-none');
        $('#fiyatListesiTableBody').empty();
        $.ajax({
          url: 'https://localhost:7232/api/cars', // API adresinizi gerekirse güncelleyin
          method: 'GET',
          success: function(data) {
            $('#fiyatListesiLoading').hide();
            if (!data || !data.length) {
              $('#fiyatListesiTableBody').html('<tr><td colspan="4" class="text-center">Kayıt bulunamadı.</td></tr>');
              return;
            }
            data.forEach(function(car) {
              $('#fiyatListesiTableBody').append(
                `<tr>
                  <td>${car.carAdi || car.carModel}</td>
                  <td>${car.carYil}</td>
                  <td>${car.carTur}</td>
                  <td>${car.carFiyat ? car.carFiyat.toLocaleString('tr-TR', { style: 'currency', currency: 'TRY' }) : '-'}</td>
                </tr>`
              );
            });
          },
          error: function() {
            $('#fiyatListesiLoading').hide();
            $('#fiyatListesiError').removeClass('d-none');
          }
        });
      }
    });
    </script>
    <script>
    $(function() {
      // Servis Randevusu butonuna tıklama
      $(document).on('click', '#servisRandevuBtn', function(e) {
        e.preventDefault();
        $('#servisRandevuModal').modal('show');
        $('#servisRandevuForm')[0].reset();
        $('#servisRandevuSuccess').addClass('d-none');
        $('#servisRandevuError').addClass('d-none');
      });
      
      // Form gönderimi
      $('#servisRandevuForm').on('submit', function(e) {
        e.preventDefault();
        $('#servisRandevuSuccess').addClass('d-none');
        $('#servisRandevuError').addClass('d-none');
        
        var formData = {};
        $(this).serializeArray().forEach(function(x) { 
          if (x.name === 'AppointmentDate') {
            // datetime-local değerini ISO formatına çevir
            var date = new Date(x.value);
            formData[x.name] = date.toISOString();
          } else {
            formData[x.name] = x.value; 
          }
        });
        
        console.log('Gönderilen veri:', formData); // Debug için
        
        $.ajax({
          url: 'https://localhost:7232/api/serviceappointment',
          method: 'POST',
          contentType: 'application/json',
          data: JSON.stringify(formData),
          success: function(response) {
            console.log('Başarılı:', response); // Debug için
            $('#servisRandevuSuccess').removeClass('d-none');
            $('#servisRandevuForm')[0].reset();
            setTimeout(function() {
              $('#servisRandevuModal').modal('hide');
            }, 2000);
          },
          error: function(xhr, status, error) {
            console.log('Hata:', xhr.responseText); // Debug için
            var errorMessage = 'Bir hata oluştu. Lütfen tekrar deneyin.';
            
            try {
              var response = JSON.parse(xhr.responseText);
              if (response.error) {
                errorMessage = response.error;
                if (response.details && response.details.length > 0) {
                  errorMessage += ': ' + response.details.join(', ');
                }
              }
            } catch (e) {
              console.log('JSON parse hatası:', e);
            }
            
            $('#servisRandevuError').text(errorMessage).removeClass('d-none');
          }
        });
      });
    });
    </script>
</body>
</html>

